(function(){"use strict";var e={6097:function(e,t,n){var o=n(9242),l=(n(541),n(7658),n(3396)),a=n(7139),s=n(4870);n(4161);const c={id:"main"},i={id:"center"},u={id:"bottom"};var r=(0,l.aZ)({__name:"dialogCom",props:{title:null,show:{type:Boolean}},setup(e){const t=e;return(e,n)=>((0,l.wg)(),(0,l.iD)("div",{id:"dialog",class:(0,a.C_)({show:t.show})},[(0,l._)("div",c,[(0,l._)("p",null,(0,a.zw)(t.title),1),(0,l._)("div",i,[(0,l.WI)(e.$slots,"center")]),(0,l._)("div",u,[(0,l.WI)(e.$slots,"bottom")])])],2))}}),d=n(89);const v=(0,d.Z)(r,[["__scopeId","data-v-3d7fadcc"]]);var p=v;let m=0;function h(e){const t=document.querySelector("body"),n=document.createElement("div");n.id="messageBox",n.className="messageBox-"+ ++m,n.innerHTML=`<div class="${e.type}">${e.content}</div>`,t?.appendChild(n),setTimeout((()=>{m--,n.remove()}),3e3)}var f=h,g=n(5792),y=n(8134),w=n.n(y),_=n(3099),k=n.n(_);const b=(0,s.iH)("");function S(e){window.localStorage.setItem("n0ts-chatgpt-theme",e),b.value=e}function C(){const e=window.localStorage.getItem("n0ts-chatgpt-theme");e?b.value=e:S("light"),document.documentElement.setAttribute("theme",e||"light")}function T(){b.value=window.localStorage.getItem("n0ts-chatgpt-theme"),b.value="light"===b.value?"dark":"light",S(b.value),C()}var O={switchTheme:T,load:C,themeCache:b},x={key:"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",data:{model:"gpt-3.5-turbo"},system:"",max_token:4096};function H(){return window.localStorage.setItem("n0ts-chatgpt-config",JSON.stringify(x)),x}function I(){const e=JSON.parse(window.localStorage.getItem("n0ts-chatgpt-config")??"{}");return e.key?(x.key=e.key,x.data=e.data,x.system=e.system,x):H()}var D={save:H,read:I,config:x},M=n(3812),A=n.n(M);const E=e=>((0,l.dD)("data-v-1dd906cc"),e=e(),(0,l.Cn)(),e),j={id:"chatgpt"},U={id:"chats"},N=["onClick"],P=["onClick"],Y={id:"bottom"},B={key:0,class:"money"},K={id:"main"},$={key:0,id:"messages"},q={class:"img"},z={key:0,class:"system"},J={key:1,class:"user"},L={key:2,class:"ai"},V=["innerHTML"],Z=E((()=>(0,l._)("div",{id:"stretch"},null,-1))),G={key:1,id:"home"},W=E((()=>(0,l._)("div",null,[(0,l._)("p",null,"🙂千禧GPT使用规范，恳请大家遵守"),(0,l._)("div",{class:"content-text"},[(0,l._)("ol",null,[(0,l._)("li",null,"请遵纪守法，不要输入不好的言语"),(0,l._)("li",null,"请勿输入涉及到个人隐私的信息，以防泄密")]),(0,l._)("span",null," 如果您有自己的OpenAI API Key，可以点击左侧打开配置菜单，输入自己的Key使用 ")])],-1))),F=[W],R={id:"input"},Q=E((()=>(0,l._)("p",null,"请在下方输入你的 key",-1))),X=E((()=>(0,l._)("p",null,[(0,l.Uk)(" 申请地址： "),(0,l._)("a",{href:"https://platform.openai.com/account/api-keys",target:"_blank"},"点我")],-1))),ee=["onKeydown"],te=E((()=>(0,l._)("p",{class:"tips"},"key 会保存在本地浏览器(localStorage)中，只供本地使用",-1))),ne={class:"panel"},oe=E((()=>(0,l._)("p",null,"key：",-1))),le=E((()=>(0,l._)("p",{class:"tips"},"OpenAI 申请的 Key",-1))),ae=E((()=>(0,l._)("p",null,"行为设定：",-1))),se=E((()=>(0,l._)("p",{class:"tips"},[(0,l._)("span",null,"给 OpenAI 设定一个行为，比如："),(0,l._)("br"),(0,l._)("span",null,"“你是一直猫，每句话后面加个 喵~”"),(0,l._)("br")],-1)));var ce=(0,l.aZ)({__name:"App",setup(e){const t=new(A()),{config:n,read:c,save:i}=D;c();const u=(0,s.iH)(""==n.key);let r=null,d=null;(0,l.bv)((()=>{d=new(k())(document.querySelector("#main")),r=document.querySelector("#messages"),O.load(),n.key}));const v=(0,s.iH)("");function m(){if(""==v.value)return f({type:"warning",content:"key 不能为空"});n.key=v.value,v.value="",i(),u.value=!1,f({type:"success",content:"key 存储成功，开始提问吧"})}const h=(0,s.iH)(!1);async function y(){h.value=!0;const e=ce[ie.value].contents,o=e[e.length-1];"assistant"!=o.role&&_("assistant","");let a=null;"system"==e[0].role&&(a=e[0]);const s=e.slice(2*ce[ie.value].exceedTokens);a&&s.unshift(a),fetch("https://api-gpt.mvtchat.com/v1/chat/completions",{method:"POST",body:JSON.stringify({model:n.data.model,messages:s.map((e=>({role:e.role,content:e.stream}))),max_tokens:2e3}),headers:{"Content-Type":"application/json",authorization:`Bearer ${n.key}`}}).then((e=>{const n=e.body.getReader(),o=new TextDecoder("utf-8");let a="";n.read().then((async function e(s){if(s.done||!h.value)return;const c=o.decode(s.value);if(c.includes('"error": {\n'))return h.value=!1,_e(c);if(c.includes('"finish_reason":"stop"')){h.value=!1;ce[ie.value].contents[ce[ie.value].contents.length-1];await(0,l.Y3)(),de(),d.update()}return c.replaceAll("data: ","").split("\n").filter(Boolean).forEach((async e=>{const n=JSON.parse(e);if(!n.choices[0].message.content)return;const o=n.choices[0].message.content;a+=o,ce[ie.value].contents[ce[ie.value].contents.length-1].content=a.includes("```")?t.render(a):a,ce[ie.value].contents[ce[ie.value].contents.length-1].stream=a,b(),await(0,l.Y3)(),de()})),n.read().then(e)}))})).catch((()=>{h.value=!1}))}async function _(e,t,n){const o=n||t,a={role:e,content:o,tokens:0,stream:o};ce[ie.value].contents.push(a),b(),await(0,l.Y3)(),de(),d.update()}function b(){window.localStorage.setItem("message-data",JSON.stringify(ce)),be()}const S=(0,s.iH)("");function C(){if(""!=S.value&&""!=S.value.trim()&&!h.value){if(-1==ie.value&&(ce.unshift({name:"",contents:[],exceedTokens:0}),ie.value=0),n.system&&0==ce[ie.value].contents.length&&_("system",t.render(n.system)),_("user",t.render(S.value)),1==ce[ie.value].contents.length||"system"==ce[ie.value].contents[0].role&&2==ce[ie.value].contents.length){const e=S.value;let t=1;ce.forEach((n=>{0==n.name.indexOf(e)&&t++})),ce[ie.value].name=e+(1==t?"":` #${t}`),document.title=e+" | MvtChat"}S.value="",y()}}let T=!1;function x(){T||(T=!0,setTimeout((()=>{T=!1,r=document.querySelector("#messages"),r?r.scrollTo({top:r.scrollHeight,behavior:"smooth"}):x()}),300))}let H=!1;function I(e){if(16===e.keyCode&&(H=!0),!H&&13===e.keyCode)return C(),e.preventDefault(),!1}function M(e){16===e.keyCode&&(H=!1)}const E=(0,s.iH)(24);(0,l.YP)((()=>S.value),(()=>{const e=S.value.split("\n").length;E.value=24*e}));const W=window.localStorage.getItem("message-data"),ce=(0,s.qj)(W?JSON.parse(W):[]),ie=(0,s.iH)(-1);function ue(){b();let e=1;ce.forEach((t=>{0==t.name.indexOf("新会话")&&e++})),ce.unshift({name:"新会话"+(1==e?"":` #${e}`),contents:[],exceedTokens:0}),S.value="",ie.value=0}function re(e){document.title="MvtChat",ce.splice(e,1),ie.value=-1,b()}async function de(){const e=[],t=document.querySelectorAll("#messages pre code");t.forEach((t=>{const n=t;if(n.getAttribute("class")?.includes("hljs"))return;const o=document.createElement("div");o.className="copyBtn",o.innerHTML="复制",o.setAttribute("code",n.innerText),o.addEventListener("click",(e=>{me(e)})),n.parentElement?.appendChild(o),g.Z.highlightElement(n),e.push(n)})),ve(e),x()}function ve(e){for(let t=0;t<e.length;t++){const n=e[t].innerHTML.replace(/\n/g,"</li><li>");e[t].innerHTML=`<ol><li>${n}</li></ol>`.replace("<li></li></ol>","</ol>")}}(0,l.YP)((()=>ie.value),(async()=>{ce[ie.value]&&(document.title=ce[ie.value].name+" | MvtChat",await(0,l.Y3)(),be(),de(),d.update())}));const pe=(0,s.iH)(!1);function me(e){const t=e.target.getAttribute("code");t&&(w().copy(t),f({type:"success",content:"复制成功"}))}function he(){window.localStorage.removeItem("message-data"),window.localStorage.removeItem("n0ts-chatgpt-theme"),window.localStorage.removeItem("n0ts-chatgpt-config"),window.location.reload()}const fe=(0,s.iH)(!1);function ge(){fe.value=!fe.value,i(),f({type:"success",content:"设置已保存"})}const ye=(0,s.iH)(null);function we(e,t){return Number(e.toFixed(t))}function _e(e){const t=JSON.parse(e.replace("未知错误，请联系站长解决！",""));return console.error("报错了哥们",t),"invalid_api_key"==t.error.code?(f({type:"danger",content:"API Key 错误，请重新配置"}),n.key="",i(),void(u.value=!0)):"context_length_exceeded"==t.error.code?(ce[ie.value].exceedTokens+=1,y()):void(ce[ie.value].contents[ce[ie.value].contents.length-1].content=e)}const ke=(0,s.iH)(0);function be(){if(!ce[ie.value])return;let e=0;ce[ie.value].contents.forEach((t=>{e+=t.tokens})),ke.value=e}function Se(){ce[ie.value].contents.splice(ce[ie.value].contents.length-1,1),h.value=!1}return(e,t)=>((0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l._)("div",j,[(0,l._)("div",{id:"sidebar",class:(0,a.C_)({sideBarShow:pe.value})},[(0,l._)("div",{class:"btns"},[(0,l._)("div",{class:"btn",onClick:ue},"➕新建会话")]),(0,l._)("div",U,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(ce,((e,t)=>((0,l.wg)(),(0,l.iD)("div",{key:t,onClick:e=>ie.value=t,class:(0,a.C_)({active:ie.value==t})},[(0,l._)("p",null,(0,a.zw)(e.name),1),(0,l._)("span",{onClick:(0,o.iM)((e=>re(t)),["stop"])},"🗑 删除",8,P)],10,N)))),128))]),(0,l._)("div",Y,[(0,l._)("div",{class:"btn",onClick:t[0]||(t[0]=(...e)=>(0,s.SU)(O).switchTheme&&(0,s.SU)(O).switchTheme(...e))},(0,a.zw)("light"==(0,s.SU)(O).themeCache.value?"🌞 暗色模式":"🌛 亮色模式"),1),(0,l._)("div",{class:"btn",onClick:t[1]||(t[1]=e=>fe.value=!0)},"🎡打开配置"),(0,l._)("div",{class:"btn",onClick:he},"🎆重置配置"),ye.value?((0,l.wg)(),(0,l.iD)("div",B," 余额："+(0,a.zw)(we(ye.value.total_available,2))+" $，已用："+(0,a.zw)(we(ye.value.total_used,2))+" $ ",1)):(0,l.kq)("",!0)]),(0,l._)("div",{id:"showBtn",onClick:t[2]||(t[2]=e=>pe.value=!pe.value)},(0,a.zw)(pe.value?"👈":"👉"),1)],2),(0,l._)("div",K,[ce[ie.value]?((0,l.wg)(),(0,l.iD)("div",$,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(ce[ie.value].contents,((e,t)=>((0,l.wg)(),(0,l.iD)("div",{key:t,class:(0,a.C_)("user"==e.role?"right":"left")},[(0,l._)("div",q,["system"==e.role?((0,l.wg)(),(0,l.iD)("div",z,"SY")):"user"==e.role?((0,l.wg)(),(0,l.iD)("div",J,"Me")):((0,l.wg)(),(0,l.iD)("div",L,"AI"))]),(0,l._)("div",{class:(0,a.C_)(["content",{end:!h.value||t!=ce[ie.value].contents.length-1}]),innerHTML:e.content},null,10,V)],2)))),128)),Z])):((0,l.wg)(),(0,l.iD)("div",G,F)),(0,l._)("div",R,[(0,l._)("div",{class:(0,a.C_)(["stop",{stopShow:h.value}]),onClick:Se},"停止回复 🛑",2),(0,l.wy)((0,l._)("textarea",{"onUpdate:modelValue":t[3]||(t[3]=e=>S.value=e),onKeydown:I,onKeyup:M,style:(0,a.j5)({height:E.value+"px"})},null,36),[[o.nr,S.value]])])])]),(0,l.Wm)(p,{title:"输入 key",show:u.value},{center:(0,l.w5)((()=>[Q,X,(0,l.wy)((0,l._)("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>v.value=e),onKeydown:(0,o.D2)(m,["enter"])},null,40,ee),[[o.nr,v.value]]),te])),bottom:(0,l.w5)((()=>[(0,l._)("button",{class:"success",onClick:m},"提交")])),_:1},8,["show"]),(0,l.Wm)(p,{title:"设置",show:fe.value},{center:(0,l.w5)((()=>[(0,l._)("div",ne,[(0,l._)("div",null,[oe,(0,l.wy)((0,l._)("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=e=>(0,s.SU)(n).key=e)},null,512),[[o.nr,(0,s.SU)(n).key]])]),le,(0,l._)("div",null,[ae,(0,l.wy)((0,l._)("input",{type:"text","onUpdate:modelValue":t[6]||(t[6]=e=>(0,s.SU)(n).system=e)},null,512),[[o.nr,(0,s.SU)(n).system]])]),se])])),bottom:(0,l.w5)((()=>[(0,l._)("button",{class:"success",onClick:ge},"保存"),(0,l._)("button",{class:"info",onClick:t[7]||(t[7]=e=>fe.value=!fe.value)},"关闭")])),_:1},8,["show"])],64))}});const ie=(0,d.Z)(ce,[["__scopeId","data-v-1dd906cc"]]);var ue=ie;(0,o.ri)(ue).mount("#app")}},t={};function n(o){var l=t[o];if(void 0!==l)return l.exports;var a=t[o]={exports:{}};return e[o].call(a.exports,a,a.exports,n),a.exports}n.m=e,function(){var e=[];n.O=function(t,o,l,a){if(!o){var s=1/0;for(r=0;r<e.length;r++){o=e[r][0],l=e[r][1],a=e[r][2];for(var c=!0,i=0;i<o.length;i++)(!1&a||s>=a)&&Object.keys(n.O).every((function(e){return n.O[e](o[i])}))?o.splice(i--,1):(c=!1,a<s&&(s=a));if(c){e.splice(r--,1);var u=l();void 0!==u&&(t=u)}}return t}a=a||0;for(var r=e.length;r>0&&e[r-1][2]>a;r--)e[r]=e[r-1];e[r]=[o,l,a]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};n.O.j=function(t){return 0===e[t]};var t=function(t,o){var l,a,s=o[0],c=o[1],i=o[2],u=0;if(s.some((function(t){return 0!==e[t]}))){for(l in c)n.o(c,l)&&(n.m[l]=c[l]);if(i)var r=i(n)}for(t&&t(o);u<s.length;u++)a=s[u],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return n.O(r)},o=self["webpackChunkchatgpt"]=self["webpackChunkchatgpt"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=n.O(void 0,[998],(function(){return n(6097)}));o=n.O(o)})();
//# sourceMappingURL=app.c51a463d.js.map